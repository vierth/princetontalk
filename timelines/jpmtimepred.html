<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <script src="d3.min.js"></script>
  <script src="rangespred.js"></script>
  <style>
    .hidden {
      display: none;
    }

    body {
      background-color: #222
    }
  </style>
</head>

<body>
  <script>
    // This viewer was cobbled together based on a wide variety of examples found online
    // Including https://bl.ocks.org/mbostock/1046712, https://github.com/d3/d3-chord,
    // https://bl.ocks.org/emeeks/a1e48992be56681e3f93, and Mees Gelein's chord viewer at
    // https://github.com/MGelein/comparativus/blob/master/js/vis.js

    // Use a chord viz if there are more than two documents. Otherwise use a bar
    // visualization

    doclengths = { "JPM": 715836, "ShuiHu": 752285, "SanGuo": 485902, "XiYouJi": 590319 }

    var width = window.innerWidth - 40;

    var height = window.innerHeight - 40;

    // colors generated by tools.medialab.sciences-po.fr/iwanthue

    var manycolors = ["#6168d8", "#5ab543", "#a45bcd", "#a7b242", "#ca4faf", "#67ba75", "#da4b83", "#49b39c", "#cd4249", "#4cbee0", "#c95a2a", "#6386d9", "#d89e3d", "#7b5a9f", "#547836", "#d28ecb", "#da8571", "#5e90c8", "#a24c69"]

    var usecolors = manycolors.slice(0, doclengths.length + 2)

    var cscale = d3.scaleLinear().domain([0, doclengths.length - 1]);

    var color = d3.scaleOrdinal(usecolors);

    var x = d3.scaleLinear().domain([0, doclengths.JPM]).range([0, width])

    let displayState = 0

    var svg = d3.select('body')
      .append('svg')
      .attr('width', width)
      .attr('height', height)
      .append('g')
      .call(zoom)
      .attr('transform', 'translate(' + 0 +
        ',' + 0 + ')');

    var textthick = 500


    text1y = height / 2 - textthick / 2
    usedoclength = doclengths.JPM


    svg.append("rect")
      .attr("x", 0)
      .attr("y", text1y)
      .attr("width", x(usedoclength))
      .attr("height", textthick)
      //.attr("class", "chart")
      .attr("fill", "black")


    svg.append("text")
      .attr("font-size", 32)
      .attr("x", width / 2)
      .attr("y", text1y - 100)
      .attr("text-anchor", "middle")
      .attr("fill", "white")
      .attr("font-family", "sans-serif")
      .text("Predicted Source of Material Appearing in Other Texts")

    svg.append("text")
      .attr("font-size", 28)
      .attr("x", width / 3)
      .attr("text-anchor", "middle")
      .attr("y", text1y - 40)
      .attr("fill", "magenta")
      .text("Prior Materials")
      .attr("font-family", "sans-serif")

    svg.append("text")
      .attr("font-size", 28)
      .attr("x", 2 * width / 3)
      .attr("text-anchor", "middle")
      .attr("y", text1y - 40)
      .attr("fill", "cyan")
      .text("Unclear Materials")
      .attr("font-family", "sans-serif")

    // svg.append("text")
    //   .attr("font-size", 28)
    //   .attr("x", 3 * width / 5)
    //   .attr("text-anchor", "middle")
    //   .attr("y", text1y - 40)
    //   .attr("fill", "orangered")
    //   .attr("font-family", "sans-serif")
    //   //.attr("class", "hidden")
    //   .text("Post-Ming materials")

    // svg.append("text")
    //   .attr("font-size", 28)
    //   .attr("x", 4 * width / 5)
    //   .attr("text-anchor", "middle")
    //   .attr("y", text1y - 40)
    //   .attr("fill", "yellow")
    //   .attr("font-family", "sans-serif")
    //   //.attr("class", "hidden")
    //   .text("Structural Materials")



    qd = quotedata[0]
    preming = quotedata[0]
    ming = quotedata[1]
    postming = quotedata[2]
    structural = quotedata[3]

    svg.selectAll('rect')
      .data(preming)
      .enter().append("rect")
      .attr("x", d => x(d[0]))
      .attr("y", text1y)
      .attr("class", "chart")
      .attr("width", d => x(d[1] - d[0]))
      .attr("height", textthick / 2)

      .attr("fill", "magenta")


    svg.selectAll('g')
      .data(ming)
      .enter().append("rect")
      .attr("x", d => x(d[0]))
      .attr("y", text1y + textthick / 2)
      .attr("class", "chart")
      .attr("width", d => x(d[1] - d[0]))
      .attr("height", textthick / 2)
      //.attr("class", "hidden")
      .attr("fill", "cyan")




    // svg.selectAll('g')
    //   .data(postming)
    //   .enter().append("rect")
    //   .attr("x", d => x(d[0]))
    //   .attr("y", text1y + 2 * textthick / 4)
    //   .attr("class", "chart")
    //   .attr("width", d => x(d[1] - d[0]))
    //   .attr("height", textthick / 4)
    //   //.attr("class","hidden")
    //   .attr("fill", "orangered")

    // svg.selectAll('g')
    //   .data(structural)
    //   .enter().append("rect")
    //   .attr("x", d => x(d[0]))
    //   .attr("y", text1y + 2 * textthick / 3)
    //   .attr("class", "chart")
    //   .attr("width", d => x(d[1] - d[0]))
    //   .attr("height", textthick / 3)
    //   //.attr("class","hidden")
    //   .attr("fill", "yellow")

    svg.selectAll("g")
      .data(chapdivs)
      .enter().append("text")
      .attr("font-size", 12)
      .attr("font-family", "sans-serif")
      .attr("text-anchor", function (d, i) { if (i == 0) { return "start" } else { return "middle" } })
      .attr("x", d => x(d))
      .attr("y", function (d, i) {
        if (i % 2) {
          return text1y + textthick + 40
        } else {
          return text1y + textthick + 20
        }
      })
      .attr("class", "chapters")
      .attr("fill", "white")
      .text(function (d, i) { return i + 1; })


    function zoom(svg) {
      const extent = [[0, 0], [width, height]]
      svg.call(d3.zoom()
        .scaleExtent([1, 48])
        .translateExtent(extent)
        .extent(extent)
        .on("zoom", zoomed))

      function zoomed() {

        x.range([0, width].map(d => d3.event.transform.applyX(d)))
        svg.selectAll(".chart")
          .attr("x", function (d) { return x(d[0]); })
          .attr("width", function (d) { return x(d[1]) - x(d[0]) })
        svg.selectAll(".chapters")
          .attr("x", function (d) { return x(d); })
      }
    }
  </script>
</body>

</html>