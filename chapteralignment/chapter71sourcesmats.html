<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<script src="d3.min.js"></script>
<script src="quotedata.js"></script>
<style>


.hidden{
  display:none;
}

body{
  background-color:#222
}


</style>
</head>
<body>
<script>
// This viewer was cobbled together based on a wide variety of examples found online
// Including https://bl.ocks.org/mbostock/1046712, https://github.com/d3/d3-chord,
// https://bl.ocks.org/emeeks/a1e48992be56681e3f93, and Mees Gelein's chord viewer at
// https://github.com/MGelein/comparativus/blob/master/js/vis.js

// Use a chord viz if there are more than two documents. Otherwise use a bar
// visualization


var width = window.innerWidth - 40;

var height = window.innerHeight - 40;

// colors generated by tools.medialab.sciences-po.fr/iwanthue

var manycolors = [ "#6168d8","#5ab543","#a45bcd","#a7b242","#ca4faf","#67ba75","#da4b83","#49b39c","#cd4249","#4cbee0","#c95a2a","#6386d9","#d89e3d","#7b5a9f","#547836","#d28ecb","#da8571","#5e90c8","#a24c69"]

var usecolors = manycolors.slice(0, 2)

var cscale = d3.scaleLinear().domain([0, 2]); 

var color = d3.scaleOrdinal(usecolors);

var x = d3.scaleLinear().domain([0,textlength]).range([0, width])

let displayState = 0

var svg = d3.select('body')
    .append('svg')
    .attr('width', width)
    .attr('height', height)
    .append('g')
    .call(zoom)
    .attr('transform', 'translate(' + 0 +
    ',' + 0 + ')');

var textthick = 260


text1y = height/3-textthick/2
usedoclength = textlength

text2y = 2*height/3-textthick/2


svg.append("rect")
                .attr("x",0)
                .attr("y",text1y)
                .attr("width",x(usedoclength))
                .attr("height",textthick)
                .attr("stroke-opacity","0.0")
                //.attr("class", "chart")
                .attr("fill","green")


// svg.append("text")
//     .attr("font-size",32)
//     .attr("x",width/2)
//     .attr("y", text1y - 50)
//     .attr("text-anchor","middle")
//     .attr("dominant-baseline","bottom")
//     .attr("fill", "white")
//     .attr("font-family", "sans-serif")
//     .text("Chapter 71: 1617 Edition")

  svg.append("rect")
              .attr("x",0)
              .attr("y",text2y)
              .attr("width",x(usedoclength))
              .attr("height",textthick)
              .attr("stroke-opacity","0.0")
              //.attr("class", "chart")
              .attr("fill","green")

// svg.append("text")
//     .attr("font-size",32)
//     .attr("x",width/2)
//     .attr("y", text2y + 50 + textthick)
//     .attr("text-anchor","middle")
//     .attr("dominant-baseline","top")
//     .attr("fill", "white")
//     .attr("font-family", "sans-serif")
//     .text("Chapter 71: 1630s Edition")


// svg.append("text")
//     .attr("font-size",32)
//     .attr("x",width/2)
//     .attr("y", text1y - 50)
//     .attr("text-anchor","middle")
//     .attr("fill", "white")
//     .attr("font-family", "sans-serif")
//     .text("Chapter 71: 1617 Edition")

svg.append("text")
  .attr("font-size", 28)
  .attr("x",width/4)
  .attr("text-anchor","start")
  .attr("y", height - 40)
  .attr("fill", "yellow")
  .attr("font-family", "sans-serif")
  .text("Deletion")

  svg.append("text")
  .attr("font-size", 28)
  .attr("x",3*width/4)
  .attr("text-anchor","end")
  .attr("y", height - 40)
  .attr("fill", "magenta")
  .attr("font-family", "sans-serif")
  .text("Insertion")

svg.append("text")
  .attr("font-size", 28)
  .attr("x",width/2)
  .attr("text-anchor","middle")
  .attr("y", height - 40)
  .attr("fill", "orangered")
  .attr("font-family", "sans-serif")
  .text("Mutation")

svg.append("text")
  .attr("font-size", 28)
  .attr("x",width/2)
  .attr("text-anchor","middle")
  .attr("y", height - 80)
  .attr("fill", "cyan")
  .attr("font-family", "sans-serif")
  .text("Detected Intertextuality")

svg.selectAll('g')
  .data(insertions)
  .enter().append("rect")
  .attr("x",d => x(d[0]))
    .attr("y", text1y)
    .attr("class", "chart")
    .attr("width",d => x(d[1]-d[0]))
    .attr("height",textthick)
    .attr("fill","#222")
    .attr("stroke-opacity","0.0")

svg.selectAll('g')
  .data(insertions)
  .enter().append("rect")
  .attr("x",d => x(d[0]))
    .attr("y", text2y)
    .attr("class", "chart")
    .attr("width",d => x(d[1]-d[0]))
    .attr("height",textthick)
    .attr("fill","magenta")
    .attr("stroke-opacity","0.0")


svg.selectAll('g')
  .data(deletions)
  .enter().append("rect")
  .attr("x",d => x(d[0]))
    .attr("y", text1y)
    .attr("class", "chart")
    .attr("width",d => x(d[1]-d[0]))
    .attr("height",textthick)
    .attr("fill","yellow")
    .attr("stroke-opacity","0.0")

svg.selectAll('g')
  .data(deletions)
  .enter().append("rect")
  .attr("x",d => x(d[0]))
    .attr("y", text2y)
    .attr("class", "chart")
    .attr("width",d => x(d[1]-d[0]))
    .attr("height",textthick)
    .attr("fill","#222")
    .attr("stroke-opacity","0.0")

svg.selectAll('g')
  .data(deletions)
  .enter().append("rect")
  .attr("x",d => x(d[0]))
    .attr("y", text2y)
    .attr("class", "chart")
    .attr("width",d => x(d[1]-d[0]))
    .attr("height",textthick)
    .attr("fill","#222")
    .attr("stroke-opacity","0.0")

svg.selectAll('g')
  .data(mutations)
  .enter().append("rect")
  .attr("x",d => x(d[0]))
    .attr("y", text1y)
    .attr("class", "chart")
    .attr("width",d => x(d[1]-d[0]))
    .attr("height",textthick)
    .attr("fill","orangered")
    .attr("stroke-opacity","0.0")

svg.selectAll('g')
  .data(mutations)
  .enter().append("rect")
  .attr("x",d => x(d[0]))
    .attr("y", text2y)
    .attr("class", "chart")
    .attr("width",d => x(d[1]-d[0]))
    .attr("height",textthick)
    .attr("fill","orangered")
    .attr("stroke-opacity","0.0")

  svg.selectAll('g')
    .data(unorg)
    .enter().append("rect")
    .attr("x",d => x(d[0]))
      .attr("y", text1y-60)
      .attr("class", "chart")
      .attr("width",d => x(d[1]-d[0]))
      .attr("height",60)
      .attr("fill","cyan")

  svg.selectAll('g')
    .data(lkx)
    .enter().append("rect")
    .attr("x",d => x(d[0]))
      .attr("y", text1y-60)
      .attr("class", "chart")
      .attr("width",d => x(d[1]-d[0]))
      .attr("height",60)
      .attr("fill","cyan")

  svg.selectAll('g')
    .data(unknown)
    .enter().append("rect")
    .attr("x",d => x(d[0]))
      .attr("y", text1y-60)
      .attr("class", "chart")
      .attr("width",d => x(d[1]-d[0]))
      .attr("height",60)
      .attr("fill","cyan")

let indices = []
for (let i = 0; i < text1.length; i ++){
  indices.push(i)
}

// svg.selectAll("g")
//   .data(indices)
//   .enter().append("text")
//   .attr("font-size",0)
//   .attr("font-family", "Songti SC")
//   .attr("text-anchor", "start")
//   .attr('display', "none")
//   .attr("dominant-baseline", "middle")
//   .attr("x", function(d){return x(d)})
//   .attr("y",text1y + textthick/2)
//   .attr("class", "words")
//   .attr("fill", "black")
//   .text(function (d) { return text1.charAt(d);})

// svg.selectAll("g")
//   .data(indices)
//   .enter().append("text")
//   .attr("font-size",0)
//   .attr('display', "none")
//   .attr("font-family", "Songti SC")
//   .attr("text-anchor", "start")
//   .attr("dominant-baseline", "middle")
//   .attr("x", function(d){return x(d)})
//   .attr("y",text2y + textthick/2)
//   .attr("class", "words")
//   .attr("fill", "black")
//   .text(function (d) { return text2.charAt(d);})

function zoom(svg){
  const extent = [[0,0],[width,height]]
  svg.call(d3.zoom()
    .scaleExtent([1,400])
    .translateExtent(extent)
    .extent(extent)
    .on("zoom", zoomed))

  function zoomed(){
    
    x.range([0, width].map(d=> d3.event.transform.applyX(d)))
    svg.selectAll(".chart")
      .attr("x", function(d){ return x(d[0]);})
      .attr("width", function(d){ return x(d[1])-x(d[0])})
    // svg.selectAll(".words")
    //   .attr("x", function(d){ return x(d);})
    //   .attr("display", function(d){if (d3.event.transform.k > 9 && x(d)>-d3.event.transform.k && x(d) < width+d3.event.transform.k){ return 1}else{return "none";}})
    //   .attr("font-size", function(d,i){if (d3.event.transform.k > 9 && x(d)>-d3.event.transform.k && x(d) < width+d3.event.transform.k){ return d3.event.transform.k/6}})
  }
}
</script>
</body>
</html>