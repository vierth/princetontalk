<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<script src="d3.min.js"></script>
<script src="shuihu_edge_data.js"></script>
<style>
.hidden{
  display:none;
}
body{
    font-family: "Avenir", Helvetica, sans-serif,"Songti SC", "SimSun",	"华文细黑","STHeiti";
}


</style>
</head>
<body>
<script>
// This viewer was cobbled together based on a wide variety of examples found online
// Including https://bl.ocks.org/mbostock/1046712, https://github.com/d3/d3-chord,
// https://bl.ocks.org/emeeks/a1e48992be56681e3f93, and Mees Gelein's chord viewer at
// https://github.com/MGelein/comparativus/blob/master/js/vis.js

if (docs.length > 2){

var fullwidth = window.innerWidth - 40;
var width = fullwidth/2
var height = window.innerHeight - 40;;
var outerradius = Math.min(width-140, height-140)/1.75;
var innerradius = outerradius - 20; 
// colors generated by tools.medialab.sciences-po.fr/iwanthue
var manycolors = ["#9b783a", "#6168d8","#5ab543","#a45bcd","#a7b242","#ca4faf","#67ba75","#da4b83","#49b39c","#cd4249","#4cbee0","#c95a2a","#6386d9","#d89e3d","#7b5a9f","#547836","#d28ecb","#da8571","#5e90c8","#a24c69"]
var usecolors = manycolors.slice(0, docs.length)
var cscale = d3.scaleLinear().domain([0, docs.length - 1]); 
var color = d3.scaleOrdinal(usecolors);

var charsonpage = 60

var svg = d3.select('body')
    .append('svg')
    .attr('width', fullwidth)
    .attr('height', height)
    .append('g')
    .attr('transform', 'translate(' + (width / 2) +
    ',' + (height / 2) + ')');

var arc = d3.arc()
    .innerRadius(innerradius)             
    .outerRadius(outerradius)

var pie = d3.pie()
    .value(function(d) { return d.len; })
    .sort(null);

var g = svg.selectAll('.arc')
    .data(pie(docs))
    .enter()
    .append('g');

g.append("path")
    .attr('d', arc)
    .attr('fill', function(d, i) { return color(cscale(i)) });



var textdata = {};

var angledata = d3.selectAll('path').data()

for (i=0; i < angledata.length;i++){
    angledata[i].scale = d3.scaleLinear().domain([0,angledata[i].value]).range([angledata[i].startAngle, angledata[i].endAngle])
    testscale = d3.scaleLinear().domain([0,angledata[i].value]).range([angledata[i].startAngle, angledata[i].endAngle])
}

var ribbon = d3.ribbon()
    .radius(innerradius);



let ribbondata = [];

for (i = 0; i < edges.length; i++) {
    let edge = edges[i]
    let edgedata = {}
    for (j = 0; j < angledata.length; j++) {
        vt1s = edge.t1s - 40 
        vt1e = edge.t1s + 40
        vt2s = edge.t2s - 40
        vt2e = edge.t2e + 40

        if (edge.t1 == angledata[j].data.doc){
            edgedata.source = {startAngle:angledata[j].scale(vt1s),endAngle:angledata[j].scale(vt1e)}
            edgedata.origin = edge.t1
        }
        if (edge.t2 == angledata[j].data.doc){
            
            edgedata.target = {startAngle:angledata[j].scale(vt2s),endAngle:angledata[j].scale(vt2e)}
        }
    }
    edgedata.sourcetitle = edge.t1
    edgedata.targettitle = edge.t2
    edgedata.snum = edge.t1.split("_")[0]
    edgedata.tnum = edge.t2.split("_")[0]
    edgedata.sourcequote = edge.t1q
    edgedata.targetquote = edge.t2q
    edgedata.sourcestart = edge.t1s
    edgedata.targetstart = edge.t2s
    ribbondata.push(edgedata)
}

let currentdata = 0;

let ribbongroup = g.append("g")
    .attr("class","ribbons")
    .selectAll("path")
    .data(ribbondata)
    .enter().append("path")
    .attr("d", ribbon)
    .style("stroke-opacity", 0.75)
    .style("fill-opacity",0.2)
    .style("stroke-width", "1px")
    .style("fill","magenta")
    .on("mouseover",function(){
        d3.select(this).style('fill-opacity', 0.9).transition()
    })
    .on("mouseout",function(){
        d3.select(this).style('fill-opacity',0.2).transition()
    })
    .on("click", function(d){
        currentdata = d
        charoffset = 0
        if (d.sourcequote.length < charsonpage) {
            cos = d.sourcequote.length
        } else {
            cos = charoffset + charsonpage
        }
        qa.text("Intertextuality ("+ charoffset+"-"+cos+" of "+ d.targetquote.length + " 字 alignment)")
        displayquote(d)
        // d3.select(ribbongroup).style('fill','magenta')
        // d3.select(this).style('fill','blue')

        })

g2 = svg.selectAll('.arc')
    .data(pie(docs))
    .enter()
    .append('g');

g2.append("text")
    .attr("transform", function(d) { return "translate(" + arc.centroid(d) + ")"; })
    .attr("dy", ".35em")
    .attr("text-anchor","middle")
    .attr("fill", "black")
    .text(function(d) {console.log(d);return d.data.doc})

function displayquote(d){
    
    t1.classed("hidden", false).text("Chapter "+d.snum) 


    t2.classed("hidden", false).text("Chapter "+d.tnum)
    
    
    t1s.classed("hidden", false).text(d.sourcestart + charoffset)
    t2s.classed("hidden", false).text(d.targetstart + charoffset)
    leftb.classed("hidden", false)
    rightb.classed("hidden", false)
    nextb.classed("hidden", false)
    prevb.classed("hidden", false)
    leftbt.classed("hidden", false)
    rightbt.classed("hidden", false)
    nextbt.classed("hidden", false)
    prevbt.classed("hidden", false)
    offlabel.classed("hidden", false)
    if (d.sourcequote.length < charsonpage) {
        cos = d.sourcequote.length
    } else {
        cos = charoffset + charsonpage
    }

    
    qa.text("Intertextuality ("+ charoffset+"-"+cos+" of a "+ d.targetquote.length + " 字)")
    for (i = 0; i < charsonpage; i ++){
        let selector = i + charoffset
        let onec = d3.select("#one"+i).text(d.sourcequote[selector])
        let twoc = d3.select("#two"+i).text(d.targetquote[selector])
        if (d.sourcequote[selector] == d.targetquote[selector]){
            onec.attr("fill","white")
            twoc.attr("fill","white")
        } else if (d.sourcequote[selector] == " " || d.targetquote[selector] == " ") {
            onec.attr("fill","green")
            twoc.attr("fill","green")
        } else {
            onec.attr("fill","magenta")
            twoc.attr("fill","magenta")
        }
    }
}



var quoteinfo = svg.append("g")
    .attr('transform', 'translate(' + (width/2) +
    ',' + -(height / 2)+ ')');



var qa = quoteinfo.append("text")
    .attr("x", 40)
    .attr("y", 80)
    .attr("font-size",32)
    .text("Intertextuality")



let yoffset = 0;

let xoffset = 0;

let charperline = 15

let kerning = 38

for (i = 0; i < charsonpage; i ++){
    if (i % charperline == 0 && i > 0) {
        yoffset += 120
    }

    xoffset = (i % charperline) * kerning

    quoteinfo.append("text")
        .attr("font-size", 28)
        .attr("x", 40 + xoffset)
        .attr("y", 260 + yoffset)
        .attr("id", "one"+ i)
        .text("")

    quoteinfo.append("text")
        .attr("font-size", 28)
        .attr("x", 40 + xoffset)
        .attr("y", 300 + yoffset)
        .attr("id", "two"+ i)
        .text("")
}



var t1 = quoteinfo.append("text").attr("x", 40).attr("y", 160).attr("font-size",28).classed("hidden", true).text("Unknown")
var t1s = quoteinfo.append("text").attr("x",30).attr("y", 160).attr("font-size",28).attr("text-anchor","end").classed("hidden", true).text(0)
var t2 = quoteinfo.append("text").attr("x", 40).attr("y", 200).attr("font-size",28).classed("hidden", true).text("Unknown")
var t2s = quoteinfo.append("text").attr("x",30).attr("y", 200).attr("font-size",28).attr("text-anchor","end").classed("hidden", true).text(0)
var offlabel = quoteinfo.append("text").attr("x",30).attr("y", 120).attr("font-size",28).attr("text-anchor","end").classed("hidden", true).text("Offset")

var rightb = quoteinfo.append("rect")
            .attr("x", 440)
            .attr("y", 138)
            .attr("width", 60)
            .attr("height",20)
            .attr("rx", 4)
            .attr("ry", 4)
            .attr("width","60")
            .attr("height","30")
            .attr("fill","black")
            .classed("hidden", true)
            .on("click", upalignment)



var rightbt = quoteinfo.append("text")
    .attr("x",470)
    .attr("y",158)
    .style('font-size', "18px")
    .style("pointer-events","none")
    .attr("text-anchor","middle")
    .attr("fill","white")
    .classed("hidden", true)
    .text("Fwd.")


var leftb = quoteinfo.append("rect")
            .attr("x", 360)
            .attr("y", 138)
            .attr("width", 60)
            .attr("height",20)
            .attr("rx", 4)
            .attr("ry", 4)
            .attr("width","60")
            .attr("height","30")
            .attr("fill","black")
            .classed("hidden", true)
            .on("click", downalignment)



var leftbt = quoteinfo.append("text")
    .attr("x",390)
    .attr("y",158)
    .style('font-size', "18px")
    .style("pointer-events","none")
    .attr("text-anchor","middle")
    .attr("fill","white")
    .classed("hidden", true)
    .text("Back")

var nextb = quoteinfo.append("rect")
        .attr("x", 440)
        .attr("y", 172)
        .attr("width", 60)
        .attr("height",20)
        .attr("rx", 4)
        .attr("ry", 4)
        .attr("width","60")
        .attr("height","30")
        .attr("fill","black")
        .classed("hidden", true)
        .on("click", next)



var nextbt =quoteinfo.append("text")
    .attr("x",470)
    .attr("y",192)
    .style('font-size', "18px")
    .style("pointer-events","none")
    .attr("text-anchor","middle")
    .attr("fill","white")
    .classed("hidden", true)
    .text("Next")


var prevb = quoteinfo.append("rect")
            .attr("x", 360)
            .attr("y", 172)
            .attr("width", 60)
            .attr("height",20)
            .attr("rx", 4)
            .attr("ry", 4)
            .attr("width","60")
            .attr("height","30")
            .attr("fill","black")
            .classed("hidden", true)
            .on("click", prev)



var prevbt = quoteinfo.append("text")
    .attr("x",390)
    .attr("y",192)
    .style('font-size', "18px")
    .style("pointer-events","none")
    .attr("text-anchor","middle")
    .attr("fill","white")
    .classed("hidden", true)
    .text("Prev")


let charoffset = 0

function upalignment(){
    charoffset += 15
    if (currentdata.sourcequote.length > charsonpage){
        if (charoffset > currentdata.sourcequote.length - charsonpage) {
            charoffset = currentdata.sourcequote.length - charsonpage;
        }
    } else {
        charoffset = 0;
    }
    
    displayquote(currentdata)
}

function downalignment(){
    charoffset -= 15
    if (charoffset< 0){
        charoffset = 0
    }
    displayquote(currentdata)
}

function next(){
    for (i = charoffset + 1; i < currentdata.sourcequote.length; i++){
        if (currentdata.sourcequote[i] != currentdata.targetquote[i]){
            charoffset = i;
            break;
        }
    }
    if (currentdata.sourcequote.length > charsonpage){
        if (charoffset > currentdata.sourcequote.length - charsonpage) {
            charoffset = currentdata.sourcequote.length - charsonpage;
        }
    } else {
        charoffset = currentdata.sourcequote.length - charsonpage;
    }
    displayquote(currentdata)
}

function prev(){
    for (i = charoffset - 1; i >= 0; i--){
        if (currentdata.sourcequote[i] != currentdata.targetquote[i]){
            charoffset = i;
            break;
        } else {
            charoffset = 0;
        }
    }
    if (charoffset < 0){
        charoffset = 0
    }
    displayquote(currentdata)
}

} else {
    // This viewer was cobbled together based on a wide variety of examples found online

// Including https://bl.ocks.org/mbostock/1046712, https://github.com/d3/d3-chord,

// https://bl.ocks.org/emeeks/a1e48992be56681e3f93, and Mees Gelein's chord viewer at

// https://github.com/MGelein/comparativus/blob/master/js/vis.js

var width = window.innerWidth - 40;

var height = window.innerHeight - 40;

// colors generated by tools.medialab.sciences-po.fr/iwanthue

var manycolors = [ "#6168d8","#5ab543","#a45bcd","#a7b242","#ca4faf","#67ba75","#da4b83","#49b39c","#cd4249","#4cbee0","#c95a2a","#6386d9","#d89e3d","#7b5a9f","#547836","#d28ecb","#da8571","#5e90c8","#a24c69"]

var usecolors = manycolors.slice(0, docs.length + 2)

var cscale = d3.scaleLinear().domain([0, docs.length - 1]); 

var color = d3.scaleOrdinal(usecolors);

var docwidthscale = d3.scaleLinear().domain([0,Math.max(docs[0].len,docs[1].len)]).range([0, (width/5)*4])

var text1y = -(height/3)

var text2y = (height/10)

var textthick = 20

var kerning = 20

var typesize = 28

var charperline = Math.floor((width/10*6)/(typesize+kerning))

var charsonpage = charperline * 2

var xoffsetnum = 22

var svg = d3.select('body')
    .append('svg')
    .attr('width', width)
    .attr('height', height)
    .append('g')
    .attr('transform', 'translate(' + (width / 2) +
    ',' + (height / 2) + ')');

var trect1 = svg.append("rect")
                .attr("x",-(docwidthscale(docs[0].len)/2))
                .attr("y",text1y)
                .attr("width",docwidthscale(docs[0].len))
                .attr("height",textthick)
                .attr("fill",usecolors[0])

var trect2 = svg.append("rect")
                .attr("x",-(docwidthscale(docs[1].len)/2))
                .attr("y",text2y)
                .attr("width",docwidthscale(docs[1].len))
                .attr("height",textthick)
                .attr("fill",usecolors[1])

svg.append("text")
    .attr("font-size",32)
    .attr("x",0)
    .attr("y", text1y - 10)
    .attr("text-anchor","middle")
    .attr("fill", "white")
    .attr("font-style", "italic")
    .text(docs[0].doc)

svg.append("text")
    .attr("font-size",32)
    .attr("x",0)
    .attr("y", text2y + textthick + 10)
    .attr("text-anchor","middle")
    .attr("dy","+.8em")
    .attr("fill", "white")
    .attr("font-style", "italic")
    .text(docs[1].doc)

var textdata = {};

let connectiondata = []

for (i = 0; i < edges.length; i++) {
    let edge = edges[i]
    let edgedata2 = {}
    edgedata2.sourcetitle = edge.t1
    edgedata2.targettitle = edge.t2
    edgedata2.sourcequote = edge.t1q
    edgedata2.targetquote = edge.t2q
    edgedata2.sourcestart = edge.t1s
    edgedata2.targetstart = edge.t2s
    edgedata2.t1xs = docwidthscale(edge.t1s) -(docwidthscale(docs[0].len)/2) 
    edgedata2.t1xe = docwidthscale(edge.t1e) -(docwidthscale(docs[0].len)/2) 
    edgedata2.t1y = text1y + textthick
    edgedata2.t2xs = docwidthscale(edge.t2s) - (docwidthscale(docs[1].len)/2)
    edgedata2.t2xe = docwidthscale(edge.t2e) - (docwidthscale(docs[1].len)/2)
    edgedata2.t2y = text2y
    connectiondata.push(edgedata2)
}

for (let i = 0; i <connectiondata.length;i++){

    let thisconnection = connectiondata[i];

    let points = String(thisconnection.t1xs)+","+String(thisconnection.t1y)+" "+String(thisconnection.t1xe)+","+ String(thisconnection.t1y)+" "+ String(thisconnection.t2xe)+","+String(thisconnection.t2y)+" "+String(thisconnection.t2xs)+","+ String(thisconnection.t2y)

    svg.append("g")
        .append("rect")
        .attr("x",thisconnection.t1xs)
        .attr("y", text1y)
        .attr("width",thisconnection.t1xe - thisconnection.t1xs)
        .attr("height",textthick)
        .attr("fill","magenta")

    svg.append("g")
        .append("rect")
        .attr("x",thisconnection.t2xs)
        .attr("y", text2y)
        .attr("width",thisconnection.t2xe - thisconnection.t2xs)
        .attr("height",textthick)
        .attr("fill","magenta")    
    svg.append("g")
    .append("polygon")
    .attr("points", points)
    .style("fill", "magenta")
    .style("stroke-opacity", 0.75)
    .style("fill-opacity",0.5)
    .style("stroke-width", "1px")
    .on("mouseover",function(){
        let ladjustment1 = 5
        let ladjustment2 = 5
        let radjustment1 = 5
        let radjustment2 = 5
        if (thisconnection.t1xs - ladjustment1 < -(docwidthscale(docs[0].len)/2) ) {
            ladjustment1 = (-(docwidthscale(docs[0].len)/2) - thisconnection.t1xs)
        } 
        if (thisconnection.t2xs - ladjustment2 < -(docwidthscale(docs[0].len)/2)){
            ladjustment2 = (-(docwidthscale(docs[0].len)/2) - thisconnection.t2xs)
        }
        if (thisconnection.t1xe + radjustment1 > (docwidthscale(docs[0].len)/2) ) {
            radjustment1 = (-(docwidthscale(docs[0].len)/2) + thisconnection.t1xe)
        } 
        if (thisconnection.t2xe - radjustment2 > (docwidthscale(docs[0].len)/2)){
            radjustment2 = (-(docwidthscale(docs[0].len)/2) + thisconnection.t2xe)
        } 

        d3.select(this).style('fill-opacity', 0.9)
                        //.attr("points", String(thisconnection.t1xs - ladjustment1)+","+String(thisconnection.t1y)+" "+String(thisconnection.t1xe + radjustment1)+","+ String(thisconnection.t1y)+" "+ String(thisconnection.t2xe+radjustment2)+","+String(thisconnection.t2y)+" "+String(thisconnection.t2xs- ladjustment2)+","+ String(thisconnection.t2y))
                       .attr("points", String(thisconnection.t1xs - 5)+","+String(thisconnection.t1y)+" "+String(thisconnection.t1xe + 5)+","+ String(thisconnection.t1y)+" "+ String(thisconnection.t2xe+5)+","+String(thisconnection.t2y)+" "+String(thisconnection.t2xs- 5)+","+ String(thisconnection.t2y))
    })
    .on("mouseout",function(){
        d3.select(this).style('fill-opacity',0.5)
            .attr("points", String(thisconnection.t1xs)+","+String(thisconnection.t1y)+" "+String(thisconnection.t1xe)+","+ String(thisconnection.t1y)+" "+ String(thisconnection.t2xe)+","+String(thisconnection.t2y)+" "+String(thisconnection.t2xs)+","+ String(thisconnection.t2y))
    })
    .on("click", function(){
        currentdata = connectiondata[i]
        charoffset = 0
        if (currentdata.sourcequote.length < charsonpage) {
            cos = currentdata.sourcequote.length
        } else {
            cos = charoffset + charsonpage
        }
        qa.text("Intertextuality ("+ charoffset+"-"+cos+" of "+ currentdata.targetquote.length + " character alignment)")
        displayquote(currentdata)
        })
} 

let currentdata = 0;

function displayquote(d){
    if (d.sourcetitle.length > 14){
        t1.classed("hidden", false).text("T1") 
    } else {
        t1.classed("hidden", false).text(d.sourcetitle) 
    }

    if (d.targettitle.length > 14){
        t2.classed("hidden", false).text("T2")
    } else {
        t2.classed("hidden", false).text(d.targettitle)
    }

    t1s.classed("hidden", false).text(d.sourcestart + charoffset)
    t2s.classed("hidden", false).text(d.targetstart + charoffset)
    leftb.classed("hidden", false)
    rightb.classed("hidden", false)
    nextb.classed("hidden", false)
    prevb.classed("hidden", false)
    leftbl.classed("hidden", false)
    rightbl.classed("hidden", false)
    nextbl.classed("hidden", false)
    prevbl.classed("hidden", false)

    if (d.sourcequote.length < charsonpage) {
        cos = d.sourcequote.length
    } else {
        cos = charoffset + charsonpage
    }

    qa.text("Intertextuality ("+ charoffset+"-"+cos+" of "+ d.targetquote.length + " character alignment)")

    for (i = 0; i < charsonpage; i ++){
        let selector = i + charoffset
        let onec = d3.select("#one"+i).text(d.sourcequote[selector])
        let twoc = d3.select("#two"+i).text(d.targetquote[selector])
        if (d.sourcequote[selector] == d.targetquote[selector]){
            onec.attr("fill","white")
            twoc.attr("fill","white")
        } else if (d.sourcequote[selector] == " " || d.targetquote[selector] == " ") {
            onec.attr("fill",manycolors[2])
            twoc.attr("fill",manycolors[2])
        } else {
            onec.attr("fill",manycolors[3])
            twoc.attr("fill",manycolors[3])
        }
    }
}

var quoteinfo = svg.append("g")

var qa = quoteinfo.append("text")
    .attr("x", 0)
    .attr("y", text2y + textthick+height/8)
    .attr("font-size",32)
    .attr("text-anchor","middle")
    .attr("fill", "white")
    .text("Intertextuality")

let yoffset = 0;

let xoffset = -((width/2)/10*6.5)

for (i = 0; i < charsonpage; i ++){
    if (i % charperline == 0 && i > 0) {
        console.log("moving")
        yoffset += 80
        xoffset = -((width/2)/10*6.5)
    }

    xoffset = xoffset+typesize+kerning

    quoteinfo.append("text")
        .attr("font-size", typesize)
        .attr("x", xoffset)
        .attr("y", text2y + textthick+height/8 + 40 + yoffset)
        .attr("id", "one"+ i)
        .attr("font-family", "monospace")
        .text("")

    quoteinfo.append("text")
        .attr("font-size", typesize)
        .attr("x", xoffset)
        .attr("y", text2y + textthick+height/8 + 80 + yoffset)
        .attr("id", "two"+ i)
        .attr("font-family", "monospace")
        .text("")
}

var t1 = quoteinfo.append("text").attr("x", (width/2)/10*6).attr("y", text2y + textthick+height/8 + 40).attr("font-size",28).classed("hidden", true).text("Unknown").attr("fill",usecolors[0])
var t1s = quoteinfo.append("text").attr("x",-(width/2)/10*6).attr("y", text2y + textthick+height/8 + 40).attr("font-size",28).attr("text-anchor","end").classed("hidden", true).text(0).attr("fill", "white")
var t2 = quoteinfo.append("text").attr("x", (width/2)/10*6).attr("y", text2y + textthick+height/8 + 80).attr("font-size",28).classed("hidden", true).text("Unknown").attr("fill",usecolors[1])
var t2s = quoteinfo.append("text").attr("x",-(width/2)/10*6).attr("y", text2y + textthick+height/8 + 80).attr("font-size",28).attr("text-anchor","end").classed("hidden", true).text(0).attr("fill", "white")

var rightb = quoteinfo.append("rect")
            .attr("x", (width/2)/10*6+5)
            .attr("y", text2y + textthick+height/8 + 100)
            .attr("width", 60)
            .attr("height",20)
            .attr("rx", 4)
            .attr("ry", 4)
            .attr("width","60")
            .attr("height","30")
            .attr("fill","black")
            .classed("hidden", true)
            .on("click", upalignment)

var rightbl = quoteinfo.append("text")
    .attr("x",(width/2)/10*6 + 35)
    .attr("y",text2y + textthick+height/8 + 120)
    .style('font-size', "18px")
    .style("pointer-events","none")
    .attr("text-anchor","middle")
    .attr("fill","white")
    .classed("hidden", true)
    .text("Fwd.")

var leftb = quoteinfo.append("rect")
            .attr("x", -(width/2)/10*6-65)
            .attr("y", text2y + textthick+height/8 + 100)
            .attr("width", 60)
            .attr("height",20)
            .attr("rx", 4)
            .attr("ry", 4)
            .attr("width","60")
            .attr("height","30")
            .attr("fill","black")
            .classed("hidden", true)
            .on("click", downalignment)

var leftbl = quoteinfo.append("text")
    .attr("x",-(width/2)/10*6-35)
    .attr("y", text2y + textthick+height/8 + 120)
    .style('font-size', "18px")
    .style("pointer-events","none")
    .attr("text-anchor","middle")
    .attr("fill","white")
    .classed("hidden", true)
    .text("Back")

var nextb = quoteinfo.append("rect")
        .attr("x", (width/2)/10*6 + 5)
        .attr("y", text2y + textthick+height/8 + 140)
        .attr("width", 60)
        .attr("height",20)
        .attr("rx", 4)
        .attr("ry", 4)
        .attr("width","60")
        .attr("height","30")
        .attr("fill","black")
        .classed("hidden", true)
        .on("click", next)

var nextbl = quoteinfo.append("text")
    .attr("x",(width/2)/10*6 + 35)
    .attr("y",text2y + textthick+height/8 + 160)
    .style('font-size', "18px")
    .style("pointer-events","none")
    .attr("text-anchor","middle")
    .attr("fill","white")
    .classed("hidden", true)
    .text("Next")

var prevb = quoteinfo.append("rect")
            .attr("x", -(width/2)/10*6-65)
            .attr("y", text2y + textthick+height/8 + 140)
            .attr("width", 60)
            .attr("height",20)
            .attr("rx", 4)
            .attr("ry", 4)
            .attr("width","60")
            .attr("height","30")
            .attr("fill","black")
            .classed("hidden", true)
            .on("click", prev)

var prevbl = quoteinfo.append("text")
    .attr("x",-(width/2)/10*6-35)
    .attr("y",text2y + textthick+height/8 + 160)
    .style('font-size', "18px")
    .style("pointer-events","none")
    .attr("text-anchor","middle")
    .attr("fill","white")
    .classed("hidden", true)
    .text("Prev")

let charoffset = 0

function upalignment(){
    charoffset += charperline
    if (currentdata.sourcequote.length > charsonpage){
        if (charoffset > currentdata.sourcequote.length - charsonpage) {
            charoffset = currentdata.sourcequote.length - charsonpage;
        }
    } else {
        charoffset = 0;
    }
    displayquote(currentdata)
}

function downalignment(){
    charoffset -= 15
    if (charoffset< 0){
        charoffset = 0
    }
    displayquote(currentdata)
}

function next(){
    for (i = charoffset + 1; i < currentdata.sourcequote.length; i++){
        if (currentdata.sourcequote[i] != currentdata.targetquote[i]){
            charoffset = i;
            break;
        }
    }
    if (currentdata.sourcequote.length > charsonpage){
        if (charoffset > currentdata.sourcequote.length - charsonpage) {
            charoffset = currentdata.sourcequote.length - charsonpage;
        }
    } else {
        charoffset = currentdata.sourcequote.length - charsonpage;
    }
    displayquote(currentdata)
}

function prev(){
    for (i = charoffset - 1; i >= 0; i--){
        if (currentdata.sourcequote[i] != currentdata.targetquote[i]){
            charoffset = i;
            break;
        } else {
            charoffset = 0;
        }
    }
    if (charoffset < 0){
        charoffset = 0
    }
    displayquote(currentdata)
}
}
</script>
</body>
</html>